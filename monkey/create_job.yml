---
- hosts: localhost
  vars: 
    gcp_cred_kind: serviceaccount
    gcp_cred_file: /Users/avery/Developer/projects/monkey-project/monkey/gcp-service-key-personal.json
    zone: us-east1-b
    region: us-east1
    firewall_rule: monkey-ansible-firewall
    uid: varb
    ansible_ssh_private_key_file: /Users/avery/Developer/projects/monkey-project/monkey/keys/ssh-key-monkey

  pre_tasks:
    - name: Get gcp user from private key
      set_fact:
        ansible_user: "sa_{{ (lookup('file', gcp_cred_file) | from_json).client_id }}"
        gcp_project: "{{ (lookup('file', gcp_cred_file) | from_json).project_id }}"
    - name: Print out ansible user
      debug:
        msg: "User {{ ansible_user }}"
  
  roles:
    - gcp/create
    - monkey_client/install
